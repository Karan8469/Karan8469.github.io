<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Guide to Shafts, Keys, and Couplings</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- MathJax Configuration - MUST be before the MathJax script itself -->
    <script type="text/javascript">
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']] // Enable single dollar signs for inline math
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <!-- MathJax Script -->
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Chosen Palette: Calm Harmony -->
    <!-- Application Structure Plan: A component-based, single-page application with a top navigation bar for 'Shafts', 'Keys', 'Couplings', 'Critical Speed', 'Formulas', and 'Summary'. This structure allows non-linear exploration, which is more user-friendly for learning and reference than a linear document. Each section uses interactive toggles (e.g., Solid vs. Hollow Shaft), calculators, and dynamic visualizations (Chart.js, HTML/CSS diagrams) to make abstract concepts tangible. This task-oriented design (calculate, compare, visualize) promotes active learning and better retention of the material. -->
    <!-- Visualization & Content Choices: 
        - Shafts: Report Info -> Torsional Stress. Goal -> Compare solid vs. hollow. Viz -> Chart.js bar chart. Interaction -> Toggle button. Justification -> Visually demonstrates material efficiency. Library -> Chart.js.
        - Shafts: Report Info -> Torsion/Twist Formulas. Goal -> Apply formulas. Viz -> HTML input fields & text output. Interaction -> User input. Justification -> Reinforces formula application. Library -> Vanilla JS.
        - Keys: Report Info -> Shear/Crushing Failure. Goal -> Differentiate failure modes. Viz -> HTML/CSS diagram. Interaction -> Hover hotspots. Justification -> Spatially links stress type to physical area. Library -> Vanilla JS.
        - Couplings: Report Info -> Rigid vs. Flexible. Goal -> Compare coupling types. Viz -> HTML/CSS diagrams & text blocks. Interaction -> Toggle button. Justification -> Facilitates understanding of design trade-offs. Library -> Vanilla JS.
        - Critical Speed: Report Info -> Resonant Frequencies. Goal -> Explain dynamic behavior. Viz -> Textual explanation, conceptual diagram description. Interaction -> N/A (conceptual). Justification -> Introduces crucial dynamic design aspect. Library -> N/A.
        - Formulas Reference: Report Info -> All key formulas. Goal -> Provide consolidated reference. Viz -> List of formulas. Interaction -> N/A. Justification -> Essential for numerical problem solving. Library -> MathJax.
        - System Summary: Report Info -> System relationships, design trade-offs, exam strategies. Goal -> Synthesize knowledge, provide practical advice. Viz -> Concept map, comparison tables, text. Interaction -> Static. Justification -> Provides a final, high-level summary and practical tips. Library -> N/A.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .active-nav {
            color: #4f46e5;
            border-bottom: 2px solid #4f46e5;
        }
        .inactive-nav {
            color: #6b7280;
            border-bottom: 2px solid transparent;
        }
        .tab-button.active {
            background-color: #4f46e5;
            color: #ffffff;
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
        }
        .accordion-button.open .accordion-icon {
            transform: rotate(180deg);
        }
        .concept-map-node {
            border: 2px solid #e5e7eb;
            padding: 1rem;
            border-radius: 0.5rem;
            background-color: #ffffff;
            text-align: center;
        }
        .concept-map-line {
            position: absolute;
            background-color: #d1d5db;
            z-index: -1;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold text-gray-900">Power Transmission Design</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#shafts" class="nav-link px-3 py-2 rounded-md text-sm font-medium inactive-nav">Shafts</a>
                        <a href="#keys" class="nav-link px-3 py-2 rounded-md text-sm font-medium inactive-nav">Keys</a>
                        <a href="#couplings" class="nav-link px-3 py-2 rounded-md text-sm font-medium inactive-nav">Couplings</a>
                        <a href="#critical-speed" class="nav-link px-3 py-2 rounded-md text-sm font-medium inactive-nav">Critical Speed</a>
                        <a href="#formulas" class="nav-link px-3 py-2 rounded-md text-sm font-medium inactive-nav">Formulas</a>
                        <a href="#summary" class="nav-link px-3 py-2 rounded-md text-sm font-medium inactive-nav">Summary</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <section id="intro" class="text-center mb-20">
            <h2 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">An Interactive Guide to Mechanical Components</h2>
            <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-600">Explore the fundamental principles behind shafts, keys, and couplings. This guide uses interactive elements to bring core mechanical engineering concepts to life.</p>
        </section>

        <section id="shafts" class="mb-24 scroll-mt-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-900">1. Shaft Design</h2>
                <p class="mt-2 max-w-3xl mx-auto text-lg text-gray-600">Shafts are the rotating backbones of machinery, transmitting torque from a power source to where it's needed. Their design is a critical balance between strength (resisting failure) and rigidity (resisting deflection).</p>
            </div>

            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                <div class="flex justify-center mb-8">
                    <div class="inline-flex rounded-md shadow-sm" role="group">
                        <button type="button" id="solidShaftBtn" class="tab-button active px-6 py-2 text-sm font-medium rounded-l-lg border border-gray-200">Solid Shaft</button>
                        <button type="button" id="hollowShaftBtn" class="tab-button px-6 py-2 text-sm font-medium rounded-r-lg border border-gray-200">Hollow Shaft</button>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-gray-800" id="shaftTypeTitle">Solid Shaft Analysis</h3>
                        <p class="text-gray-600 mb-4" id="shaftTypeDesc">In a solid shaft, stress is zero at the center and maximum at the outer surface. The core material contributes little to torque transmission but adds weight.</p>
                        <div class="chart-container">
                            <canvas id="shaftStressChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">Interactive Calculator</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="torque" class="block text-sm font-medium text-gray-700">Torque (T) in N-m</label>
                                <input type="number" id="torque" value="1500" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="outerDiameter" class="block text-sm font-medium text-gray-700">Outer Diameter (Dₒ) in mm</label>
                                <input type="number" id="outerDiameter" value="50" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            </div>
                            <div id="innerDiameterContainer" class="hidden">
                                <label for="innerDiameter" class="block text-sm font-medium text-gray-700">Inner Diameter (Dᵢ) in mm</label>
                                <input type="number" id="innerDiameter" value="25" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            </div>
                            <button id="calculateBtn" class="w-full bg-indigo-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-indigo-700 transition">Calculate</button>
                        </div>
                        <div id="results" class="mt-6 bg-indigo-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-indigo-800">Results:</h4>
                            <p class="text-sm text-indigo-700" id="maxStressResult"></p>
                            <p class="text-sm text-indigo-700" id="angleTwistResult"></p>
                            <p class="text-sm text-indigo-700" id="weightComparison"></p>
                        </div>
                    </div>
                </div>
                
                <div class="mt-12">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Key Concepts & Formulas</h3>
                    <div class="space-y-3">
                        <div class="accordion-item border border-gray-200 rounded-lg">
                            <button class="accordion-button w-full flex justify-between items-center p-4 text-left font-medium text-gray-700 bg-gray-100 hover:bg-gray-200">
                                <span>Torsion Formula (Strength)</span>
                                <span class="accordion-icon transition-transform duration-300">&#9660;</span>
                            </button>
                            <div class="accordion-content p-4 bg-white">
                                <p class="text-gray-600">This formula calculates the shear stress ($\tau$) at any point in the shaft. The design must ensure the maximum stress is below the material's allowable shear strength.</p>
                                <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$\tau = \frac{Tr}{J}$$</p>
                                <p class="text-gray-600">Where T is torque, r is the radial distance, and J is the polar moment of inertia.</p>
                            </div>
                        </div>
                        <div class="accordion-item border border-gray-200 rounded-lg">
                            <button class="accordion-button w-full flex justify-between items-center p-4 text-left font-medium text-gray-700 bg-gray-100 hover:bg-gray-200">
                                <span>Angle of Twist (Rigidity)</span>
                                <span class="accordion-icon transition-transform duration-300">&#9660;</span>
                            </button>
                            <div class="accordion-content p-4 bg-white">
                                <p class="text-gray-600">This formula calculates the angular deflection ($\phi$) of the shaft. Excessive twist can cause operational issues, so it must be limited.</p>
                                <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$\phi = \frac{TL}{GJ}$$</p>
                                <p class="text-gray-600">Where L is length and G is the shear modulus of the material.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="keys" class="mb-24 scroll-mt-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-900">2. Key Design</h2>
                <p class="mt-2 max-w-3xl mx-auto text-lg text-gray-600">Keys are the small but mighty components that lock a hub (like a gear or pulley) to a shaft, preventing slip and ensuring torque is transmitted. Their design must prevent two primary failure modes: shear and crushing.</p>
            </div>

            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                 <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div class="relative flex justify-center items-center h-64">
                        <div class="absolute w-48 h-48 bg-gray-200 rounded-full"></div>
                        <div class="absolute w-12 h-12 bg-white rounded-full border-4 border-gray-400"></div>
                        <div id="key-shear-area" class="absolute w-20 h-5 bg-red-400/70" style="top: 50%; left: 50%; transform: translate(-50%, -170%);"></div>
                        <div id="key-crush-area" class="absolute w-20 h-2.5 bg-blue-400/70" style="top: 50%; left: 50%; transform: translate(-50%, -340%);"></div>
                        <div class="absolute text-sm font-semibold" style="top: 50%; left: 50%; transform: translate(120%, -250%);" id="key-label">Hover to inspect</div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">Failure Mode Analysis</h3>
                        <p class="text-gray-600 mb-6">A key transmits force from the shaft to the hub. This force can cause the key to fail in two ways. Hover over the diagram to see the areas affected by each failure mode.</p>
                        <div class="space-y-4">
                            <div id="shear-info" class="p-4 border-l-4 border-red-500 bg-red-50 rounded-r-lg">
                                <h4 class="font-bold text-red-800">Shear Failure</h4>
                                <p class="text-red-700">The key is sliced in half along the plane where the shaft and hub meet. This is resisted by the key's cross-sectional area.</p>
                                <p class="mt-2 text-center text-md font-mono bg-red-100 p-2 rounded">$$\tau_{key} = \frac{2T}{w L_k D}$$</p>
                            </div>
                            <div id="crush-info" class="p-4 border-l-4 border-blue-500 bg-blue-50 rounded-r-lg">
                                <h4 class="font-bold text-blue-800">Crushing (Bearing) Failure</h4>
                                <p class="text-blue-700">The sides of the key or keyway are crushed due to high contact pressure. This is resisted by the side area of the key.</p>
                                <p class="mt-2 text-center text-md font-mono bg-blue-100 p-2 rounded">$$\sigma_{crushing} = \frac{4T}{h L_k D}$$</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="couplings" class="mb-24 scroll-mt-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-900">3. Coupling Design</h2>
                <p class="mt-2 max-w-3xl mx-auto text-lg text-gray-600">Couplings connect two shafts end-to-end. The choice between a rigid or flexible coupling depends entirely on whether the shafts can be perfectly aligned and if shock absorption is needed.</p>
            </div>

            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                <div class="flex justify-center mb-8">
                    <div class="inline-flex rounded-md shadow-sm" role="group">
                        <button type="button" id="flangeCouplingBtn" class="tab-button active px-6 py-2 text-sm font-medium rounded-l-lg border border-gray-200">Flange (Rigid)</button>
                        <button type="button" id="bushedPinCouplingBtn" class="tab-button px-6 py-2 text-sm font-medium rounded-r-lg border border-gray-200">Bushed Pin (Flexible)</button>
                    </div>
                </div>
                
                <div id="flangeContent">
                    <div class="grid md:grid-cols-2 gap-8 items-center">
                        <div>
                            <h3 class="text-xl font-semibold mb-2 text-gray-800">Flange Coupling</h3>
                            <p class="text-gray-600 mb-4">This rigid coupling connects perfectly aligned shafts. Torque is transmitted by the shear force in the bolts. It offers high torque capacity but no misalignment tolerance or shock absorption.</p>
                            <div class="p-4 border-l-4 border-green-500 bg-green-50 rounded-r-lg">
                                <h4 class="font-bold text-green-800">Key Design Factor: Bolt Shear</h4>
                                <p class="text-green-700">The bolts must be strong enough to resist the shear force generated by the transmitted torque.</p>
                                <p class="mt-2 text-center text-md font-mono bg-green-100 p-2 rounded">$$\tau_{bolt} = \frac{T}{N A_{bolt} R_{pitch}}$$</p>
                            </div>
                        </div>
                        <div class="flex justify-center items-center h-64">
                            <div class="relative w-48 h-48 border-4 border-gray-400 rounded-full flex items-center justify-center">
                                <div class="w-10 h-10 bg-white border-2 border-gray-500 rounded-full"></div>
                                <div class="absolute w-3 h-3 bg-gray-700 rounded-full" style="transform: translate(60px, 0px);"></div>
                                <div class="absolute w-3 h-3 bg-gray-700 rounded-full" style="transform: translate(-60px, 0px);"></div>
                                <div class="absolute w-3 h-3 bg-gray-700 rounded-full" style="transform: translate(0px, 60px);"></div>
                                <div class="absolute w-3 h-3 bg-gray-700 rounded-full" style="transform: translate(0px, -60px);"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="bushedPinContent" class="hidden">
                    <div class="grid md:grid-cols-2 gap-8 items-center">
                        <div>
                            <h3 class="text-xl font-semibold mb-2 text-gray-800">Bushed Pin Coupling</h3>
                            <p class="text-gray-600 mb-4">This flexible coupling uses pins with rubber or leather bushes to connect shafts. It accommodates minor misalignments and dampens vibrations.</p>
                            <div class="p-4 border-l-4 border-purple-500 bg-purple-50 rounded-r-lg">
                                <h4 class="font-bold text-purple-800">Key Design Factor: Bearing Pressure</h4>
                                <p class="text-purple-700">The primary failure mode is wear on the flexible bushes. The bearing pressure on them must be kept below the material's limit.</p>
                                <p class="mt-2 text-center text-md font-mono bg-purple-100 p-2 rounded">$$P_{bearing} = \frac{T}{N R_{pitch} d_{pin} L_{bush}}$$</p>
                            </div>
                        </div>
                        <div class="flex justify-center items-center h-64">
                            <div class="relative w-48 h-48 border-2 border-dashed border-gray-400 rounded-full flex items-center justify-center">
                                 <div class="w-10 h-10 bg-white border-2 border-gray-500 rounded-full"></div>
                                <div class="absolute w-5 h-5 bg-purple-300 rounded-full flex justify-center items-center" style="transform: translate(60px, 0px);"><div class="w-2 h-2 bg-gray-700 rounded-full"></div></div>
                                <div class="absolute w-5 h-5 bg-purple-300 rounded-full flex justify-center items-center" style="transform: translate(-60px, 0px);"><div class="w-2 h-2 bg-gray-700 rounded-full"></div></div>
                                <div class="absolute w-5 h-5 bg-purple-300 rounded-full flex justify-center items-center" style="transform: translate(0px, 60px);"><div class="w-2 h-2 bg-gray-700 rounded-full"></div></div>
                                <div class="absolute w-5 h-5 bg-purple-300 rounded-full flex justify-center items-center" style="transform: translate(0px, -60px);"><div class="w-2 h-2 bg-gray-700 rounded-full"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="critical-speed" class="mb-24 scroll-mt-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-900">4. Critical Speed of Shafts</h2>
                <p class="mt-2 max-w-3xl mx-auto text-lg text-gray-600">Beyond static strength and rigidity, shafts operating at high speeds are susceptible to resonance, a phenomenon known as critical speed. Understanding and avoiding these speeds is vital for preventing catastrophic vibrations and ensuring safe operation.</p>
            </div>

            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                <h3 class="text-xl font-semibold mb-4 text-gray-800">What is Critical Speed?</h3>
                <p class="text-gray-600 mb-4">Every rotating shaft has natural frequencies of vibration, similar to a guitar string. When the rotational speed of the shaft matches one of these natural frequencies, it's called a "<strong>critical speed.</strong>" At critical speeds, even small imbalances can cause very large deflections and vibrations, potentially leading to shaft failure, bearing damage, or excessive noise.</p>
                
                <h3 class="text-xl font-semibold mb-4 text-gray-800">Relevance in Mechanical Design</h3>
                <p class="text-gray-600 mb-4">Designing shafts involves ensuring that their operating speed is sufficiently far from any critical speed. This is crucial for smooth operation, preventing excessive stress, and extending the lifespan of the shaft and its supporting components (like bearings). Engineers typically aim to operate shafts at speeds significantly below or above their first critical speed.</p>
                
                <h3 class="text-xl font-semibold mb-4 text-gray-800">Real-World Analogy: A Car Tire Imbalance</h3>
                <p class="text-gray-600 mb-4">Imagine a car tire that is slightly out of balance. At low speeds, you might not notice it. But as you accelerate, there's a specific speed range where the car starts to vibrate violently. This is because the rotational speed of the tire matches one of the vehicle's natural vibration frequencies. Exceeding or staying below this speed makes the vibration less noticeable. Similarly, a shaft has speeds where even minor imbalances cause large, dangerous vibrations.</p>

                <h3 class="text-xl font-semibold mb-4 text-gray-800">Key Formula (Simplified for a Single Mass)</h3>
                <p class="text-gray-600 mb-2">For a simplified case of a massless shaft with a single concentrated mass ($m$) at its center, supported by two bearings (simply supported), the first critical speed ($N_c$) can be approximated by Dunkerley's formula or a direct relationship with static deflection:</p>
                <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$N_c = \frac{60}{2\pi} \sqrt{\frac{g}{\delta_{st}}}$$</p>
                <p class="text-gray-600">Where $g$ is the acceleration due to gravity and $\delta_{st}$ is the static deflection of the shaft under the mass $m$. More complex shaft geometries and multiple masses require more advanced analytical or numerical methods (e.g., Rayleigh's method, transfer matrix method).</p>

                <h3 class="text-xl font-semibold mb-4 text-gray-800">Connection to Previous Topics</h3>
                <p class="text-gray-600 mb-4">Critical speed analysis is directly linked to the shaft's <strong>bending stiffness</strong> (EI) and its geometry, which determine its static deflection and natural frequencies. A stiffer shaft (higher EI) will generally have a higher critical speed. This highlights that shaft design is not just about resisting static loads but also about managing dynamic behavior.</p>

                <h3 class="text-xl font-semibold mb-4 text-gray-800">Common Misconceptions</h3>
                <ul>
                    <li class="text-gray-600 mb-2"><strong>Critical speed is a fixed value:</strong> Critical speed depends on the shaft's material, dimensions, support conditions, and the distribution of masses along its length. It's not a universal constant for all shafts.</li>
                    <li class="text-gray-600"><strong>Only high-speed shafts need critical speed analysis:</strong> Even shafts operating at relatively low speeds can encounter critical speeds if they are very flexible or have significant imbalances.</li>
                </ul>

                <h3 class="text-xl font-semibold mb-4 text-gray-800">Typical Student Mistakes</h3>
                <ul>
                    <li class="text-gray-600 mb-2"><strong>Ignoring critical speed entirely:</strong> A common oversight in initial designs, leading to potential vibration issues in prototypes.</li>
                    <li class="text-gray-600"><strong>Confusing critical speed with operating speed:</strong> The operating speed should <strong>avoid</strong> critical speeds, not match them.</li>
                    <li class="text-gray-600"><strong>Over-simplifying complex systems:</strong> Applying simplified formulas to shafts with multiple masses or complex support conditions, leading to inaccurate critical speed predictions.</li>
                </ul>

                <h3 class="text-xl font-semibold mb-4 text-gray-800">Mini-Summary</h3>
                <p class="text-gray-600">Critical speed is the rotational speed at which a shaft's operating frequency matches its natural vibration frequency, leading to resonance and large deflections. Designing shafts requires avoiding operation at or near these critical speeds to ensure stability, minimize vibration, and prevent premature failure, making it a crucial dynamic design consideration linked to the shaft's bending stiffness.</p>

                <h3 class="text-xl font-semibold mb-4 text-gray-800">Checkpoint Questions</h3>
                <ol class="list-decimal list-inside text-gray-600">
                    <li class="mb-2">What is the primary consequence of operating a shaft at its critical speed?</li>
                    <li>How does increasing a shaft's bending stiffness (EI) generally affect its critical speed?</li>
                </ol>
            </div>
        </section>

        <section id="formulas" class="mb-24 scroll-mt-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-900">5. Formulas Reference</h2>
                <p class="mt-2 max-w-3xl mx-auto text-lg text-gray-600">This section provides a consolidated list of key formulas discussed in this guide, essential for solving numerical problems in the design of shafts, keys, and couplings.</p>
            </div>

            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                <h3 class="text-xl font-semibold mb-4 text-gray-800">Shaft Design Formulas</h3>
                <div class="space-y-6 mb-8">
                    <div>
                        <h4 class="font-medium text-gray-700">Torsion Formula (Shear Stress)</h4>
                        <p class="text-sm text-gray-600 mb-2">Calculates shear stress ($\tau$) at any radius ($r$) in a shaft under torque ($T$).</p>
                        <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$\tau = \frac{Tr}{J}$$</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                            <li>$T$: Applied Torque (N-m)</li>
                            <li>$r$: Radial distance from the center of the shaft (m)</li>
                            <li>$J$: Polar moment of inertia of the shaft's cross-section (m⁴)</li>
                            <li>$\tau$: Shear stress (Pa)</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-700">Angle of Twist Formula (Rigidity)</h4>
                        <p class="text-sm text-gray-600 mb-2">Calculates the angular deflection ($\phi$) of a shaft of length ($L$) under torque ($T$).</p>
                        <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$\phi = \frac{TL}{GJ}$$</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                            <li>$T$: Applied Torque (N-m)</li>
                            <li>$L$: Length of the shaft (m)</li>
                            <li>$G$: Shear modulus of the shaft material (Pa)</li>
                            <li>$J$: Polar moment of inertia of the shaft's cross-section (m⁴)</li>
                            <li>$\phi$: Angle of twist (radians)</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-700">Polar Moment of Inertia (Solid Shaft)</h4>
                        <p class="text-sm text-gray-600 mb-2">For a solid circular shaft with diameter ($D$).</p>
                        <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$J = \frac{\pi D^4}{32}$$</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                            <li>$D$: Diameter of the solid shaft (m)</li>
                            <li>$J$: Polar moment of inertia (m⁴)</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-700">Polar Moment of Inertia (Hollow Shaft)</h4>
                        <p class="text-sm text-gray-600 mb-2">For a hollow circular shaft with outer diameter ($D_o$) and inner diameter ($D_i$).</p>
                        <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$J = \frac{\pi (D_o^4 - D_i^4)}{32}$$</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                            <li>$D_o$: Outer diameter of the hollow shaft (m)</li>
                            <li>$D_i$: Inner diameter of the hollow shaft (m)</li>
                            <li>$J$: Polar moment of inertia (m⁴)</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-700">Maximum Shear Stress (Combined Loading - Tresca)</h4>
                        <p class="text-sm text-gray-600 mb-2">Calculates the maximum shear stress ($\tau_{max}$) on the shaft surface under combined bending ($\sigma_x$) and torsion ($\tau_{xy}$). Suitable for ductile materials.</p>
                        <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$\tau_{max} = \sqrt{\left(\frac{\sigma_x}{2}\right)^2 + \tau_{xy}^2}$$</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                            <li>$\sigma_x$: Normal stress due to bending (Pa)</li>
                            <li>$\tau_{xy}$: Shear stress due to torsion (Pa)</li>
                            <li>$\tau_{max}$: Maximum shear stress (Pa)</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-700">Von Mises Equivalent Stress (Combined Loading - Ductile Materials)</h4>
                        <p class="text-sm text-gray-600 mb-2">Calculates the equivalent stress ($\sigma_v$) for ductile materials under combined bending ($\sigma_x$) and torsion ($\tau_{xy}$).</p>
                        <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$\sigma_v = \sqrt{\sigma_x^2 + 3\tau_{xy}^2}$$</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                            <li>$\sigma_x$: Normal stress due to bending (Pa)</li>
                            <li>$\tau_{xy}$: Shear stress due to torsion (Pa)</li>
                            <li>$\sigma_v$: Von Mises equivalent stress (Pa)</li>
                        </ul>
                    </div>
                </div>

                <h3 class="text-xl font-semibold mb-4 text-gray-800">Key Design Formulas</h3>
                <div class="space-y-6 mb-8">
                    <div>
                        <h4 class="font-medium text-gray-700">Shear Stress in Key</h4>
                        <p class="text-sm text-gray-600 mb-2">Calculates the shear stress ($\tau_{key}$) in a key of width ($w$) and effective length ($L_k$) transmitting torque ($T$) to a shaft of diameter ($D$).</p>
                        <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$\tau_{key} = \frac{2T}{w L_k D}$$</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                            <li>$T$: Transmitted Torque (N-m)</li>
                            <li>$w$: Key width (m)</li>
                            <li>$L_k$: Key effective length (m)</li>
                            <li>$D$: Shaft diameter (m)</li>
                            <li>$\tau_{key}$: Shear stress in the key (Pa)</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-700">Crushing (Bearing) Stress in Key</h4>
                        <p class="text-sm text-gray-600 mb-2">Calculates the crushing stress ($\sigma_{crushing}$) in a key of height ($h$) and effective length ($L_k$) transmitting torque ($T$) to a shaft of diameter ($D$).</p>
                        <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$\sigma_{crushing} = \frac{4T}{h L_k D}$$</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                            <li>$T$: Transmitted Torque (N-m)</li>
                            <li>$h$: Key height (m)</li>
                            <li>$L_k$: Key effective length (m)</li>
                            <li>$D$: Shaft diameter (m)</li>
                            <li>$\sigma_{crushing}$: Crushing (bearing) stress in the key (Pa)</li>
                        </ul>
                    </div>
                </div>

                <h3 class="text-xl font-semibold mb-4 text-gray-800">Coupling Design Formulas</h3>
                <div class="space-y-6 mb-8">
                    <div>
                        <h4 class="font-medium text-gray-700">Flange Coupling: Bolt Shear Stress</h4>
                        <p class="text-sm text-gray-600 mb-2">Calculates the shear stress ($\tau_{bolt}$) in each bolt of area ($A_{bolt}$) in a flange coupling with ($N$) bolts at pitch radius ($R_{pitch}$) transmitting torque ($T$).</p>
                        <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$\tau_{bolt} = \frac{T}{N A_{bolt} R_{pitch}}$$</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                            <li>$T$: Transmitted Torque (N-m)</li>
                            <li>$N$: Number of bolts</li>
                            <li>$A_{bolt}$: Cross-sectional area of one bolt (m²)</li>
                            <li>$R_{pitch}$: Pitch circle radius of bolts (m)</li>
                            <li>$\tau_{bolt}$: Shear stress in the bolt (Pa)</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-700">Bushed Pin Coupling: Pin Shear Stress</h4>
                        <p class="text-sm text-gray-600 mb-2">Calculates the shear stress ($\tau_{pin}$) in each pin of area ($A_{pin}$) in a bushed pin coupling with ($N$) pins at pitch radius ($R_{pitch}$) transmitting torque ($T$).</p>
                        <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$\tau_{pin} = \frac{T}{N A_{pin} R_{pitch}}$$</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                            <li>$T$: Transmitted Torque (N-m)</li>
                            <li>$N$: Number of pins</li>
                            <li>$A_{pin}$: Cross-sectional area of one pin (m²)</li>
                            <li>$R_{pitch}$: Pitch circle radius of pins (m)</li>
                            <li>$\tau_{pin}$: Shear stress in the pin (Pa)</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-700">Bushed Pin Coupling: Bearing Pressure on Bushing</h4>
                        <p class="text-sm text-gray-600 mb-2">Calculates the bearing pressure ($P_{bearing}$) on the bushing of effective length ($L_{bush}$) for a pin of diameter ($d_{pin}$) transmitting torque ($T$) in a bushed pin coupling.</p>
                        <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$P_{bearing} = \frac{T}{N R_{pitch} d_{pin} L_{bush}}$$</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                            <li>$T$: Transmitted Torque (N-m)</li>
                            <li>$N$: Number of pins</li>
                            <li>$R_{pitch}$: Pitch circle radius of pins (m)</li>
                            <li>$d_{pin}$: Pin diameter (m)</li>
                            <li>$L_{bush}$: Effective length of bushing (m)</li>
                            <li>$P_{bearing}$: Bearing pressure on the bushing (Pa)</li>
                        </ul>
                    </div>
                </div>

                <h3 class="text-xl font-semibold mb-4 text-gray-800">Critical Speed Formula</h3>
                <div class="space-y-6">
                    <div>
                        <h4 class="font-medium text-gray-700">First Critical Speed (Simplified)</h4>
                        <p class="text-sm text-gray-600 mb-2">Approximates the first critical speed ($N_c$) for a massless shaft with a single concentrated mass ($m$) at its center, supported by two bearings.</p>
                        <p class="my-2 text-center text-lg font-mono bg-gray-100 p-2 rounded">$$N_c = \frac{60}{2\pi} \sqrt{\frac{g}{\delta_{st}}}$$</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                            <li>$g$: Acceleration due to gravity (m/s²)</li>
                            <li>$\delta_{st}$: Static deflection of the shaft under the mass (m)</li>
                            <li>$N_c$: Critical speed (RPM)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="summary" class="scroll-mt-20">
             <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-900">6. System Summary</h2>
                <p class="mt-2 max-w-3xl mx-auto text-lg text-gray-600">Understanding how these components work together is key to designing robust mechanical systems. A shaft transmits power, a key connects it to other elements, and a coupling joins it to another shaft.</p>
            </div>
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                <h3 class="text-xl font-semibold mb-6 text-center text-gray-800">Concept Map: The Power Transmission Chain</h3>
                <div class="relative flex flex-col md:flex-row justify-around items-center space-y-8 md:space-y-0 md:space-x-8">
                    <div class="concept-map-node w-48">
                        <h4 class="font-bold">Shaft</h4>
                        <p class="text-sm text-gray-600">Transmits Torque & Rotation</p>
                    </div>
                    <div class="concept-map-node w-48">
                        <h4 class="font-bold">Key</h4>
                        <p class="text-sm text-gray-600">Locks Hub to Shaft</p>
                    </div>
                    <div class="concept-map-node w-48">
                        <h4 class="font-bold">Coupling</h4>
                        <p class="text-sm text-gray-600">Connects Shafts</p>
                    </div>
                    <div class="hidden md:block">
                        <div class="concept-map-line" style="left: 20%; top: 50%; width: 20%; height: 2px; transform: translateY(-50%);"></div>
                        <div class="concept-map-line" style="left: 60%; top: 50%; width: 20%; height: 2px; transform: translateY(-50%);"></div>
                    </div>
                     <div class="md:hidden">
                        <div class="concept-map-line" style="left: 50%; top: 20%; height: 20%; width: 2px; transform: translateX(-50%);"></div>
                        <div class="concept-map-line" style="left: 50%; top: 60%; height: 20%; width: 2px; transform: translateX(-50%);"></div>
                    </div>
                </div>
                <div class="mt-12">
                    <h3 class="text-xl font-semibold mb-4 text-center text-gray-800">Design Trade-Offs</h3>
                     <div class="overflow-x-auto">
                        <table class="w-full min-w-max text-left">
                            <thead>
                                <tr class="border-b">
                                    <th class="p-2 font-semibold">Component</th>
                                    <th class="p-2 font-semibold">Solid Shaft</th>
                                    <th class="p-2 font-semibold">Hollow Shaft</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b">
                                    <td class="p-2 font-medium">Strength/Weight</td>
                                    <td class="p-2">Lower</td>
                                    <td class="p-2 font-medium text-green-600">Higher</td>
                                </tr>
                                 <tr class="border-b">
                                    <td class="p-2 font-medium">Cost</td>
                                    <td class="p-2 font-medium text-green-600">Lower</td>
                                    <td class="p-2">Higher</td>
                                </tr>
                            </tbody>
                             <thead>
                                <tr class="border-b">
                                    <th class="p-2 font-semibold">Component</th>
                                    <th class="p-2 font-semibold">Flange Coupling</th>
                                    <th class="p-2 font-semibold">Bushed Pin Coupling</th>
                                </tr>
                            </thead>
                             <tbody>
                                <tr class="border-b">
                                    <td class="p-2 font-medium">Misalignment</td>
                                    <td class="p-2 font-medium text-red-600">None</td>
                                    <td class="p-2">Tolerates Minor</td>
                                </tr>
                                 <tr>
                                    <td class="p-2 font-medium">Shock Absorption</td>
                                    <td class="p-2 font-medium text-red-600">None</td>
                                    <td class="p-2">Dampens Shocks</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="mt-12">
                    <h3 class="text-xl font-semibold mb-4 text-center text-gray-800">Tackling Numerical Problems & Exam Strategies</h3>
                    <p class="text-gray-600 mb-4">Solving numerical problems in machine design requires a systematic approach. Here's a guide to help you tackle them effectively in exams and avoid common pitfalls:</p>

                    <h4 class="font-semibold text-gray-700 mb-2">1. Structured Approach to Solving Numericals</h4>
                    <ol class="list-decimal list-inside text-gray-600 mb-6 space-y-2">
                        <li>
                            <strong>Understand the Problem:</strong> Read the question carefully, multiple times if necessary. Identify what is given (knowns) and what needs to be found (unknowns). Visualize the physical setup.
                        </li>
                        <li>
                            <strong>Draw a Diagram/Free-Body Diagram (FBD):</strong> Sketching the component (shaft, key, coupling) with all applied forces, torques, and reactions is crucial. This helps in correctly identifying load types (bending, torsion, axial) and their points of application.
                        </li>
                        <li>
                            <strong>Identify Relevant Formulas & Principles:</strong> Based on the loads and the component, select the appropriate formulas (e.g., torsion formula, shear stress in key, bolt shear). Consider which failure theory (e.g., Tresca, Von Mises) is suitable for the given material (ductile vs. brittle).
                        </li>
                        <li>
                            <strong>Ensure Unit Consistency:</strong> This is paramount. Convert all given values to a single, consistent unit system (e.g., SI units: meters, Newtons, Pascals, N-m) <em>before</em> starting calculations. Write down units at every step.
                        </li>
                        <li>
                            <strong>Step-by-Step Calculation:</strong> Show all your steps clearly. Substitute values into formulas and perform calculations systematically. Avoid skipping steps, as this makes it harder to trace errors.
                        </li>
                        <li>
                            <strong>Check Assumptions & Limitations:</strong> Briefly state any major assumptions you are making (e.g., pure torsion, uniform load distribution). Be aware of the limitations of the formulas used.
                        </li>
                        <li>
                            <strong>Verify and Interpret Results:</strong> Once you have an answer, ask yourself: Does this make physical sense? Is the magnitude reasonable? For example, a shaft diameter of 1 meter for a small motor is clearly incorrect. Compare calculated stresses with allowable stresses and safety factors.
                        </li>
                    </ol>

                    <h4 class="font-semibold text-gray-700 mb-2">2. Common Mistakes Students Make</h4>
                    <ul class="list-disc list-inside text-gray-600 mb-6 space-y-2">
                        <li>
                            <strong>Unit Inconsistency:</strong> The most frequent and impactful error. Mixing millimeters with meters, or N/mm² with N/m² without proper conversion.
                        </li>
                        <li>
                            <strong>Incorrect Moment of Inertia:</strong> Confusing area moment of inertia ($I$) for bending with polar moment of inertia ($J$) for torsion, or using the wrong formula for solid vs. hollow shafts.
                        </li>
                        <li>
                            <strong>Ignoring Combined Loading:</strong> Only considering torsion or bending, even when the problem implies both. Always check for both types of stresses and use combined stress theories.
                        </li>
                        <li>
                            <strong>Neglecting Stress Concentration Factors:</strong> Failing to apply $K_t$ or $K_f$ at geometric discontinuities (keyways, shoulders) when calculating stresses, especially for fatigue analysis.
                        </li>
                        <li>
                            <strong>Misinterpreting Question Requirements:</strong> Not designing for <em>both</em> strength and rigidity when required, or misidentifying the critical failure mode (e.g., only checking shear for a key when crushing is critical).
                        </li>
                        <li>
                            <strong>Mathematical Errors:</strong> Simple arithmetic or algebraic mistakes, particularly when rearranging formulas or dealing with exponents.
                        </li>
                        <li>
                            <strong>Not Checking Allowable Stresses/Safety Factors:</strong> Calculating stresses but failing to compare them against the material's allowable limits or the specified safety factor.
                        </li>
                    </ul>

                    <h4 class="font-semibold text-gray-700 mb-2">3. Exam Tips</h4>
                    <ul class="list-disc list-inside text-gray-600 space-y-2">
                        <li>
                            <strong>Time Management:</strong> Allocate time based on the marks for each question. Don't get stuck on one problem for too long.
                        </li>
                        <li>
                            <strong>Show All Work:</strong> Even if your final answer is wrong, showing clear, logical steps can earn partial credit.
                        </li>
                        <li>
                            <strong>Write Down Formulas:</strong> Explicitly write down the formulas you are using before substituting values.
                        </li>
                        <li>
                            <strong>Use Diagrams:</strong> Even simple sketches can help clarify your thought process and prevent errors.
                        </li>
                        <li>
                            <strong>Review and Double-Check:</strong> If time permits, review your calculations and ensure all questions have been answered completely and correctly.
                        </li>
                    </ul>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white">
        <div class="container mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-gray-500 text-sm">
            <p>&copy; 2025 Interactive Mechanical Design Guide. For educational purposes.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const G_STEEL = 80e9; 
            const DENSITY_STEEL = 7850; 

            let shaftStressChart;

            const solidShaftBtn = document.getElementById('solidShaftBtn');
            const hollowShaftBtn = document.getElementById('hollowShaftBtn');
            const innerDiameterContainer = document.getElementById('innerDiameterContainer');
            const calculateBtn = document.getElementById('calculateBtn');
            
            const shaftTypeTitle = document.getElementById('shaftTypeTitle');
            const shaftTypeDesc = document.getElementById('shaftTypeDesc');

            function createChart(data, labels) {
                const ctx = document.getElementById('shaftStressChart').getContext('2d');
                if (shaftStressChart) {
                    shaftStressChart.destroy();
                }
                shaftStressChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Shear Stress (MPa)',
                            data: data,
                            backgroundColor: 'rgba(79, 70, 229, 0.6)',
                            borderColor: 'rgba(79, 70, 229, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: 'Shear Stress Distribution'
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Shear Stress (MPa)'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Position from Center'
                                }
                            }
                        }
                    }
                });
            }

            function updateShaftUI(isSolid) {
                innerDiameterContainer.style.display = isSolid ? 'none' : 'block';
                solidShaftBtn.classList.toggle('active', isSolid);
                hollowShaftBtn.classList.toggle('active', !isSolid);
                shaftTypeTitle.textContent = isSolid ? 'Solid Shaft Analysis' : 'Hollow Shaft Analysis';
                shaftTypeDesc.textContent = isSolid 
                    ? "In a solid shaft, stress is zero at the center and maximum at the outer surface. The core material contributes little to torque transmission but adds weight."
                    : "A hollow shaft is more weight-efficient. By removing the low-stress core, it achieves a higher strength-to-weight ratio, as stress is concentrated in the outer material.";
                calculateAndDisplay();
                // MathJax.typeset(); // Calling typeset here after content change
            }

            function calculateAndDisplay() {
                const T = parseFloat(document.getElementById('torque').value);
                const Do_mm = parseFloat(document.getElementById('outerDiameter').value);
                const Do_m = Do_mm / 1000;
                
                const isSolid = innerDiameterContainer.style.display === 'none';
                let Di_m = 0, J = 0, maxStress = 0, angleTwist = 0;
                let chartData = [], chartLabels = [];

                if (isSolid) {
                    J = (Math.PI * Math.pow(Do_m, 4)) / 32;
                    maxStress = (T * (Do_m / 2)) / J;

                    for (let i = 0; i <= 5; i++) {
                        let r = (Do_m / 2) * (i / 5);
                        let stress = (T * r) / J;
                        chartData.push(stress / 1e6);
                        chartLabels.push(`${(i * 20)}% Radius`);
                    }
                } else {
                    const Di_mm = parseFloat(document.getElementById('innerDiameter').value);
                    Di_m = Di_mm / 1000;
                    if (Di_mm >= Do_mm) {
                        document.getElementById('maxStressResult').textContent = 'Error: Inner diameter must be less than outer diameter.';
                        return;
                    }
                    J = (Math.PI * (Math.pow(Do_m, 4) - Math.pow(Di_m, 4))) / 32;
                    maxStress = (T * (Do_m / 2)) / J;
                    
                    for (let i = 0; i <= 5; i++) {
                        let ratio = (Di_m / Do_m) + (1 - (Di_m / Do_m)) * (i/5);
                        let r = (Do_m / 2) * ratio;
                        let stress = (T * r) / J;
                        chartData.push(stress / 1e6);
                        chartLabels.push(`${Math.round(ratio*100)}% Radius`);
                    }
                }

                angleTwist = (T * 1) / (G_STEEL * J) * (180 / Math.PI);

                document.getElementById('maxStressResult').textContent = `Max Shear Stress: ${maxStress > 0 ? (maxStress / 1e6).toFixed(2) : 'N/A'} MPa`;
                document.getElementById('angleTwistResult').textContent = `Angle of Twist: ${angleTwist > 0 ? angleTwist.toFixed(4) : 'N/A'} deg/meter`;
                
                const solidVolume = (Math.PI * Math.pow(Do_m / 2, 2)) * 1;
                const solidWeight = solidVolume * DENSITY_STEEL;
                const hollowVolume = (Math.PI * (Math.pow(Do_m / 2, 2) - Math.pow(Di_m / 2, 2))) * 1;
                const hollowWeight = hollowVolume * DENSITY_STEEL;
                
                if (isSolid) {
                    document.getElementById('weightComparison').textContent = `Weight per meter: ${solidWeight.toFixed(2)} kg`;
                } else {
                    const weightSaving = ((solidWeight - hollowWeight) / solidWeight) * 100;
                    document.getElementById('weightComparison').textContent = `Weight per meter: ${hollowWeight.toFixed(2)} kg (${weightSaving.toFixed(1)}% lighter than solid)`;
                }

                createChart(chartData, chartLabels.reverse());
            }

            solidShaftBtn.addEventListener('click', () => updateShaftUI(true));
            hollowShaftBtn.addEventListener('click', () => updateShaftUI(false));
            calculateBtn.addEventListener('click', calculateAndDisplay);

            const flangeCouplingBtn = document.getElementById('flangeCouplingBtn');
            const bushedPinCouplingBtn = document.getElementById('bushedPinCouplingBtn');
            const flangeContent = document.getElementById('flangeContent');
            const bushedPinContent = document.getElementById('bushedPinContent');

            flangeCouplingBtn.addEventListener('click', () => {
                flangeContent.style.display = 'block';
                bushedPinContent.style.display = 'none';
                flangeCouplingBtn.classList.add('active');
                bushedPinCouplingBtn.classList.remove('active');
                MathJax.typeset(); // Re-typeset MathJax after content change
            });

            bushedPinCouplingBtn.addEventListener('click', () => {
                flangeContent.style.display = 'none';
                bushedPinContent.style.display = 'block';
                bushedPinCouplingBtn.classList.add('active');
                flangeCouplingBtn.classList.remove('active');
                MathJax.typeset(); // Re-typeset MathJax after content change
            });
            
            const keyShearArea = document.getElementById('key-shear-area');
            const keyCrushArea = document.getElementById('key-crush-area');
            const keyLabel = document.getElementById('key-label');
            const shearInfo = document.getElementById('shear-info');
            const crushInfo = document.getElementById('crush-info');

            keyShearArea.addEventListener('mouseover', () => {
                keyLabel.textContent = 'Shear Plane';
                shearInfo.style.transform = 'scale(1.05)';
                shearInfo.style.transition = 'transform 0.2s';
            });
            keyShearArea.addEventListener('mouseout', () => {
                keyLabel.textContent = 'Hover to inspect';
                shearInfo.style.transform = 'scale(1)';
            });

            keyCrushArea.addEventListener('mouseover', () => {
                keyLabel.textContent = 'Crushing Face';
                crushInfo.style.transform = 'scale(1.05)';
                crushInfo.style.transition = 'transform 0.2s';
            });
             keyCrushArea.addEventListener('mouseout', () => {
                keyLabel.textContent = 'Hover to inspect';
                crushInfo.style.transform = 'scale(1)';
            });
            
            document.querySelectorAll('.accordion-button').forEach(button => {
                button.addEventListener('click', () => {
                    const content = button.nextElementSibling;
                    button.classList.toggle('open');
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                    }
                    MathJax.typeset(); // Re-typeset MathJax after content change
                });
            });

            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('main section');

            window.addEventListener('scroll', () => {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= sectionTop - 80) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active-nav');
                    link.classList.add('inactive-nav');
                    if (link.getAttribute('href').includes(current)) {
                        link.classList.add('active-nav');
                        link.classList.remove('inactive-nav');
                    }
                });
            });

            // Initial calls to ensure everything is set up and rendered
            updateShaftUI(true); 
            MathJax.typesetPromise(); // Initial typeset on page load
        });
    </script>
</body>
</html>
